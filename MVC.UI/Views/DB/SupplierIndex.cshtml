@{
    ViewBag.Title = "公司管理";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<body>
    <div class="easyui-layout" data-options="fit:true" id="tb">
        <!-------------------------------搜索框----------------------------------->
        <div data-options="region:'north'" style="padding: 1px; height: 70px">
            <fieldset>
                <legend>{{Condition}}</legend>

                <form id="ffSearch" method="post">
                    <div id="searchdiv">
                        <table cellspacing="0" cellpadding="0">
                            <tr>
                                <td>
                                    <label for="searchCategory">{{Parent_Category}}：</label>
                                </td>
                                <td>
                                    <select class="easyui-combotree" id="searchCategory" name="searchCategory" style="width: 250px;" data-options="required:true,url:'/System/GetSysList?SysId=2&first=null'"></select>
                                </td>
                                <td>
                                    &nbsp;&nbsp;  
                                </td>
                                <td>
                                    <label for="searchCOGS">{{COGS}}：</label>
                                </td>
                                <td>
                                    <input class="easyui-textbox" type="text" id="searchCOGS" name="searchCOGS" style="width: 150px;" maxlength="50" />
                                </td>
                                <td>
                                    &nbsp;&nbsp;
                                </td>
                                <td>
                                    <label for="searchCompany">{{Company}}：</label>
                                </td>
                                <td>
                                    <input class="easyui-textbox" type="text" id="searchCompany" name="searchCompany" style="width: 150px;" maxlength="50" />
                                </td>
                                <td>
                                    &nbsp;&nbsp;<a href="#" class="easyui-linkbutton" data-options="iconCls:'icon-search'" id="btnSearch" onclick="doSearch();">{{Search}}</a>
                                </td>
                            </tr>
                        </table>
                    </div>
                </form>

            </fieldset>

        </div>
        <!------------------------------------------------------------------------>
        <div data-options="region:'center'">
            <!-------------------------------详细信息展示表格----------------------------------->
            <table id="dgrid" class="easyui-datagrid" fit="true" idfield="Id" title="" data-options="
               url: '/DB/SupplierSearch',
               rownumbers:true,
               pagination:true,
               pagenumber:1,
               pageSize:pageSize,
               pageList:pageList,
               toolbar:'#toolbar',
               remoteSort:true,
               sortName:'Company',
               sortOrder:'asc',
               singleSelect:true,
               nowrap:false,
               loadMsg: loadMsg,
               striped : true,
                fit: true,
               fitColumns:true,
                method:'post',
               onLoadSuccess:onLoadSuccess
               ">
                <thead>
                    <tr>
                        <th data-options="field:'Id',width:80,fixed:true,align:'center',formatter:Operation_formatter">{{Operation}}</th>
                        <th data-options=" field:'Parent_Category',width:150,sortable:true">{{Parent_Category}}</th>
                        <th data-options=" field:'Category',width:120,sortable:true">{{Category}}</th>
                        <th data-options=" field:'COGS',width:120,sortable:true">{{COGS}}</th>
                        <th data-options=" field:'Company',width:120,sortable:true">{{Company}}</th>
                        <th data-options=" field:'Contact',width:100,fixed:true,sortable:true">{{Contact}}</th>
                        <th data-options=" field:'Tel1',width:90,fixed:true,sortable:true,formatter:formatTel">{{Tel}}</th>
                    </tr>
                </thead>
            </table>
            <!-------------------------------详细信息展示表格----------------------------------->
        </div>
    </div>
    <!-------------------------------操作按钮----------------------------------->
    <div id="toolbar" style="height:auto">
        <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-add',plain:true" onclick="AddData();">{{Add}}</a>
    </div>
    <div id="menu" class="easyui-menu" style="width: 50px; display: none;">
        <!--放置一个隐藏的菜单Div-->
        <div data-options="iconCls:'icon-add'" onclick="AddData();">{{Add}}</div>
        <div data-options="iconCls:'icon-edit'" onclick="EditData();">{{Edit}}</div>
        <div data-options="iconCls:'icon-delete'" onclick="DeleteData();">{{Delete}}</div>
    </div>
    @*添加弹窗*@
    <div id="dlg_addDialog" class="easyui-dialog" title="" style="width:720px;height:370px;" data-options="iconCls:'icon-save',buttons: [{
					text:$lang('Save'),
					iconCls:'icon-accept',
					handler:function(){
						Dialog_Save();
					}
				},{
					text:$lang('Close'),
                    iconCls:'icon-cancel',
					handler:function(){
						 $('#dlg_addDialog').dialog('close')
					}
				}]" closed="true">
        <form id="fmAdd" method="post" data-options="novalidate:true">
            <div id="tabAdd" class="easyui-tabs">
                <div v-bind:title="title" style="padding:10px">
                    <table id="tblAdd" class="windowtable">
                        <tr>
                            <td class="firstTd" style="width:130px"><label for="com_Category">{{Category}}：</label></td>
                            <td class="nthTd" colspan="3">
                                <select class="easyui-combotree" id="com_Category" name="com_Category" data-options="required:true,url:'/System/GetSysList?SysId=2'" style="width:100%;"></select>
                            </td>
                         </tr> 
                        <tr>
                            <td class="firstTd" style="width:130px"><label for="txt_COGS">{{COGS}}：</label></td>
                            <td class="nthTd" style="width:230px"><input class="easyui-textbox" id="txt_COGS" name="txt_COGS" data-options="required:true,validType:'length[1,100]' " style="width:100%;" /></td>
                            <td class="firstTd" style="width:130px"><label for="txt_COGS2">{{COGS2}}：</label></td>
                            <td class="nthTd" style="width:230px"><input class="easyui-textbox" id="txt_COGS2" name="txt_COGS2" data-options="validType:'length[0,100]' " style="width:100%;" /></td>
                        </tr>
                        <tr>
                            <td class="firstTd"><label for="txt_Company">{{Company}}：</label></td>
                            <td class="nthTd" colspan="3"><input class="easyui-textbox" id="txt_Company" name="txt_Company" data-options="required:true,validType:'length[1,100]' " style="width:100%;" /></td>
                        </tr>
                        <tr>  
                            <td class="firstTd"><label for="txt_Rebates">{{Rebates}}：</label></td>
                            <td class="nthTd"><input class="easyui-numberbox" precision="2" id="txt_Rebates" name="txt_Rebates" data-options="validType:'length[0,10]' " value="0" style="width:100%;" /></td>
                            <td class="firstTd"><label for="txt_Cycle">{{Cycle}}：</label></td>
                            <td class="nthTd"><input class="easyui-textbox" id="txt_Cycle" name="txt_Cycle" data-options="validType:'length[0,10]' " style="width:100%;" /></td>
                        </tr>  
                        <tr>
                            <td class="firstTd"><label for="com_Collect">{{Collect}}：</label></td>
                            <td class="nthTd">
                                <select class="easyui-combobox" id="com_Collect" name="com_Collect" style="width:100%;">
                                    <option value="">　</option>
                                    <option value="Post">Post</option>
                                    <option value="Collect">Collect</option>
                                </select>
                             </td>
                            <td class="firstTd"><label for="txt_Contact">{{Contact}}：</label></td>
                            <td class="nthTd"><input class="easyui-textbox" id="txt_Contact" name="txt_Contact" data-options="validType:'length[0,30]' " style="width:100%;" /></td>
                        </tr>
                        <tr>
                            <td class="firstTd"><label for="txt_Tel1">{{Tel1}}：</label></td>
                            <td class="nthTd"><input class="easyui-textbox" id="txt_Tel1" name="txt_Tel1" data-options="validType:'length[0,20]' " style="width:100%;" /></td>
                            <td class="firstTd"><label for="txt_Tel2">{{Tel2}}：</label></td>
                            <td class="nthTd"><input class="easyui-textbox" id="txt_Tel2" name="txt_Tel2" data-options="validType:'length[0,20]' " style="width:100%;" /></td>
                        </tr>
                        <tr> 
                            <td class="firstTd"><label for="txt_Fax1">{{Fax1}}：</label></td>
                            <td class="nthTd"><input class="easyui-textbox" id="txt_Fax1" name="txt_Fax1" data-options="validType:'length[0,20]' " style="width:100%;" /></td>
                            <td class="firstTd"><label for="txt_Fax2">{{Fax2}}：</label></td>
                            <td class="nthTd"><input class="easyui-textbox" id="txt_Fax2" name="txt_Fax2" data-options="validType:'length[0,20]' " style="width:100%;" /></td>
                        </tr>
                        <tr>
                            <td class="firstTd"><label for="txt_Hp">{{Hp}}：</label></td>
                            <td class="nthTd"><input class="easyui-textbox" id="txt_Hp" name="txt_Hp" data-options="validType:'length[0,20]' " style="width:100%;" /></td>
                            <td class="firstTd"><label for="txt_Email">{{Email}}：</label></td>
                            <td class="nthTd"><input class="easyui-textbox" id="txt_Email" name="txt_Email" data-options="validType:'length[0,30]' " style="width:100%;" /></td>
                        </tr>
                        <tr>  
                            <td class="firstTd"><label for="txt_BankName">{{BankName}}：</label></td>
                            <td class="nthTd"><input class="easyui-textbox" id="txt_BankName" name="txt_BankName" data-options="validType:'length[0,50]' " style="width:100%;" /></td>
                            <td class="firstTd"><label for="txt_BankCode">{{BankCode}}：</label></td>
                            <td class="nthTd"><input class="easyui-textbox" id="txt_BankCode" name="txt_BankCode" data-options="validType:'length[0,10]' " style="width:100%;" /></td>
                        </tr>
                        <tr>
                            <td class="firstTd"><label for="txt_BankNumber">{{BankNumber}}：</label></td>
                            <td class="nthTd" colspan="3"><input class="easyui-textbox" id="txt_BankNumber" name="txt_BankNumber" data-options="validType:'length[0,10]' " style="width:100%;" /></td>
                        </tr>
                        <tr>
                            <td class="firstTd"><label for="txt_Remark">{{Remark}}：</label></td>
                            <td class="nthTd" colspan="3"><input class="easyui-textbox" id="txt_Remark" name="txt_Remark" data-options="multiline:true,validType:'length[0,500]' " style="width:100%;height:40px" /></td>
                        </tr>
                    </table>
                </div>
            </div>
        </form>
    </div>

</body>

@section body_after{
    @*vm script*@
    <script>
        //所有VM多在这里
        //grid表头
        var vm_gridhead = new Vue({
            el: '#tb',
            data: {
                Condition: $lang("Search Condition"),
                Search: $lang("Search"),
                Operation: $setLang("Operation", "操作"),
                Parent_Category: $setLang("Category", "分类"),
                Category: $setLang("Sub-Category", "子分类"),
                COGS: $setLang("COGS", "资料"),
                COGS2: $setLang("COGS2", "资料2"),
                Company: $setLang("Company Name", "公司名称"),
                Rebates: $setLang("Rebates(%)", "回扣(%)"),
                Cycle: $setLang("Payment Cycle(Moth)", "付款周期(月)"),
                Collect: $setLang("Post/Self Collect", "付款方"),
                Contact: $setLang("Contact Person", "联系人"),
                Tel: $setLang("Tel", "联系电话"),
                Tel1: $setLang("Tel1", "联系电话1"),
                Tel2: $setLang("Tel2", "联系电话2"),
                Fax1: $setLang("Fax1", "传真1"),
                Fax2: $setLang("Fax2", "传真2"),
                Hp: $setLang("Hp/Pg", "手机号码"),
                Email: $setLang("Email", "邮件"),
                BankName: $setLang("Bank Name", "银行名称"),
                BankCode: $setLang("Bank Code", "银行代码"),
                BankNumber: $setLang("Bank Number", "银行账号"),
                Remark: $setLang("Remark", "备注"), 
            }
        })
        //toolbar按钮
        var vm_toolbar = new Vue({
            el: '#toolbar',
            data: {
                Add: $lang("Add"),
                Edit: $lang("Edit"),
                Delete: $lang("Delete"),
            }
        })
        //menu菜单
        var vm_menu = new Vue({
            el: '#menu',
            data: {
                Add: $lang("Add"),
                Edit: $lang("Edit"),
                Delete: $lang("Delete"),
            }
        })
        //增加修改模态框
        var vm_dialog = new Vue({
            el: '#dlg_addDialog',
            data: {
                title: $lang("Basic Information"),
                Category: $setLang("Category", "分类"),
                COGS: $setLang("COGS", "资料"),
                COGS2: $setLang("COGS2", "资料2"),
                Company: $setLang("Company Name", "公司名称"),
                Rebates: $setLang("Rebates(%)", "回扣(%)"),
                Cycle: $setLang("Payment Cycle(Moth)", "付款周期(月)"),
                Collect: $setLang("Post/Self Collect", "付款方"),
                Contact: $setLang("Contact Person", "联系人"),
                Tel: $setLang("Tel", "联系电话"),
                Tel1: $setLang("Tel1", "联系电话1"),
                Tel2: $setLang("Tel2", "联系电话2"),
                Fax1: $setLang("Fax1", "传真1"),
                Fax2: $setLang("Fax2", "传真2"),
                Hp: $setLang("Hp/Pg", "手机号码"),
                Email: $setLang("Email", "邮件"),
                BankName: $setLang("Bank Name", "银行名称"),
                BankCode: $setLang("Bank Code", "银行代码"),
                BankNumber: $setLang("Bank Number", "银行账号"),
                Remark: $setLang("Remark", "备注"),
            }
        })
    </script>
    <script type="text/javascript">
        var TbId = 0; //表的Id
        var width = 760; //窗框宽度
        var height = 520; //窗框高度 
        var tops = 1;
        var left = 1;
        var type = "Add"; //区分修改还是新增，修改：Edit
        var url = "/DB/SupplierAction";
        //新增相关****************************
        function AddData() {
            $('#dlg_addDialog').dialog({
                title: $lang('Add'),
                width: width,
                height: height,
                top: tops,
                left: left,
                closed: false,
                draggable: true,
                resizable: true,
                maximizable: true,
                collapsible: true,
                cache: false,
                modal: true

            });
            type = "Add";
            TbId = 0;
            //  $('#fmAdd').form('clear'); //清除表单,所有的
            $('#fmAdd').form('reset'); //清除表单
            //$("#comEnable").textbox('setValue', 'true')
        }
        //更新数据按钮
        function Dialog_Save() {
            $('#fmAdd').form('submit',
                {
                    onSubmit: function () {
                        var b = $(this).form('enableValidation').form('validate');
                        if (b) { 
                            //创建传递的参数
                            var postdata = {
                                Action: type,
                                Id: TbId,
                                CategoryId: $("#com_Category").combobox('getValue'),
                                COGS: $("#txt_COGS").val(),
                                COGS2: $("#txt_COGS2").val(),
                                Company: $("#txt_Company").val(),
                                Rebates: $("#txt_Rebates").val(),
                                Cycle: $("#txt_Cycle").val(),
                                Collect: $("#com_Collect").combobox('getValue'),
                                Contact: $("#txt_Contact").val(),
                                Tel: $("#txt_Tel1").val(),
                                Tel2: $("#txt_Tel2").val(),
                                Fax: $("#txt_Fax1").val(),
                                Fax2: $("#txt_Fax2").val(),
                                Hp: $("#txt_Hp").val(),
                                Email: $("#txt_Email").val(),
                                BankName: $("#txt_BankName").val(),
                                BankCode: $("#txt_BankCode").val(),
                                BankNumber: $("#txt_BankNumber").val(),
                                Remark: $("#txt_Remark").val(), 
                            };
                            //发送异步请求到后台保存用户数据
                            $.post(url,
                                postdata,
                                function (data, status) {
                                    if (status == "success" && data === "OK") {
                                        msgShow($lang('The System Prompt'), $lang('The Operation Successful'), 'info');
                                        $('#dlg_addDialog').dialog('close');
                                        $("#dgrid").datagrid("reload");
                                    } else {
                                        msgShow($lang('The System Prompt'), $lang('The Operation Failure'), 'error');
                                    }
                                });


                        } else {
                            msgShow($lang('The System Prompt'), $lang('Validation Failure'), 'warning');
                        }
                    }
                });
        }
        //************************************
        //修改相关****************************
        function EditData(id, rowObject) { 
            TbId = id;
            type = "Edit";
            $('#fmAdd').form('load', { 
                com_Category: rowObject.CategoryId,
                txt_COGS: rowObject.COGS,
                txt_COGS2: rowObject.COGS2,
                txt_Company: rowObject.Company,
                txt_Rebates: rowObject.Rebates,
                txt_Cycle: rowObject.Cycle,
                com_Collect: rowObject.Collect,
                txt_Contact: rowObject.Contact,
                txt_Tel1: rowObject.Tel,
                txt_Tel2: rowObject.Tel2,
                txt_Fax1: rowObject.Fax,
                txt_Fax2: rowObject.Fax2,
                txt_Hp: rowObject.Hp,
                txt_Email: rowObject.Email,
                txt_BankName: rowObject.BankName,
                txt_BankCode: rowObject.BankCode,
                txt_BankNumber: rowObject.BankNumber,
                txt_Remark: rowObject.Remark,

            });

            $('#dlg_addDialog').dialog({
                title: $lang('Edit'),
                width: width,
                height: height,
                top: tops,
                left: left,
                closed: false,
                draggable: true,
                resizable: true,
                maximizable: true,
                collapsible: true,
                cache: false,
                modal: true
            });
         

        }
        //************************************
        //删除相关****************************
        function DeleteData(id, rowObject) {
            TbId = id; 
            type = "Delete"; 
                //发送异步请求删除数据
                $.messager.confirm($lang('The System Prompt'), $lang('Are You Sure Delete Selected Data ?'),
                    function (DeleteSelect) {
                        if (DeleteSelect) {
                        $.post(url,
                            { Action: type, Id: id },
                            function (data, status) {
                                console.log(status);
                                if (status == "success" && data == "OK") {
                                    msgShow($lang('The System Prompt'), $lang('The Operation Successful'), 'info');
                                    $("#dgrid").datagrid("reload");
                                    $("#dgrid").datagrid("clearSelections");
                                } else {
                                    msgShow($lang('The System Prompt'), $lang('The Operation Failure'), 'error');
                                }
                            });
                        }
                    });
             
        }
        //************************************
        //查询相关****************************
        function doSearch() {
            $('#dgrid').datagrid('load', {
                COGS: $('#searchCOGS').val(),
                CategoryId: $('#searchCategory').combobox('getValue'),
                Company: $('#searchCompany').val(),
            });  
        }
        //************************************
        //其它方法****************************
        function formatOper(val, row, index) {
            return "<img src='../images/edit.png'  style='cursor: pointer;' title='" + $lang("Edit") + "' onclick='EditData(" + JSON.stringify(row) + ",\"" + val + "\")'  ></img>&nbsp;&nbsp;" +
                     "<img src='../images/delete.png' style='cursor: pointer;' title='" + $lang("Delete") + "'  onclick='DeleteData(" + val + ")'></img>";

        }
        function formatTel(val, row, index) {
            var reslut = "";
            if (row.Tel!= null && row.Tel2 != null)
            {
                reslut = row.Tel + " / " + row.Tel2;
            }
            else
            {
                if (row.Tel != null) {
                    reslut = row.Tel;
                }
                if (row.Tel2 != null) {
                    reslut =  row.Tel2;
                } 
            }
            return reslut;
        }
      
        //************************************
    </script>
}
