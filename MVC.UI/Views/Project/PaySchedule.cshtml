@{
    ViewBag.Title = "项目付款计划";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<body>
    <div class="easyui-layout" data-options="fit:true" id="tb">
        <!-------------------------------搜索框----------------------------------->
        <!------------------------------------------------------------------------>
        <div data-options="region:'center'">
            <!-------------------------------详细信息展示表格----------------------------------->
            <table id="Fee_dgrid" class="easyui-datagrid" fit="true" data-options="
               rownumbers:true,
               pagination:true,
               pagenumber:1,
               pageSize:pageSize,
               pageList:pageList,
               toolbar:'#Fee_toolbar',
               remoteSort:true,
               sortName:'PayNo',
               sortOrder:'asc',
               singleSelect:true,
               nowrap:false,
               loadMsg: loadMsg,
               striped : true,
               fitColumns:true,
               method:'post'
               ">
                <thead>
                    <tr>
                        <th data-options=" field:'PayNo',width:70,formatter: PayNoformater">
                            {{PayNo}}
                        </th>
                        <th data-options=" field:'Remark',width:150,sortable:false">{{Remark}}</th>
                        
                        <th data-options=" field:'PlanPayDate',width:90,sortable:false,formatter:CreateDateFormat">{{PlanPayDate}}</th>
                        <th data-options=" field:'PlayFee',width:90,sortable:false,formatter:function(value,row,index){
                            return value+'%';
                            }">{{PlayFee}}</th>
                        <th data-options=" field:'PayDate',width:90,sortable:false,formatter:CreateDateFormat">{{PayDate}}</th>
                          <th data-options=" field:'Status',width:70,formatter: Statusformater">
                            {{Status}}
                        </th> 
                    </tr>
                </thead>
            </table>
            <!-------------------------------详细信息展示表格----------------------------------->
        </div>
    </div>
    <!-------------------------------操作按钮----------------------------------->
    <div id="Fee_toolbar" style="height:auto">
        <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-add',plain:true" onclick="AddFeeData();">{{Add}}</a>
        <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-edit',plain:true" onclick="EditFeeData();">{{Edit}}</a>
        <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-delete',plain:true" onclick="DeleteFeeData();">{{Delete}}</a>
    </div>
    @*添加弹窗*@
    <div id="dlg_addFeeDialog" class="easyui-dialog" title="" style="width:740px;height:340px;" data-options="iconCls:'icon-save',buttons: [{
					text:$lang('Save'),
					iconCls:'icon-accept',
					handler:function(){
						Dialog_SaveFee();
					}
				},{
					text:$lang('Close'),
                    iconCls:'icon-cancel',
					handler:function(){
						 $('#dlg_addFeeDialog').dialog('close')
					}
				}]" closed="true">
        <form id="fmAdd_Fee" method="post" data-options="novalidate:true">
            <div id="tabAdd_Fee" class="easyui-tabs">
                <div v-bind:title="title" style="padding:10px">
                    <table id="tblAdd_Fee" class="windowtable">
                        <tr>
                            <td class="firstTd" style="width:130px"><label for="com_PayNo">{{PayNo}}：</label></td>
                            <td class="nthTd">
                                <select class="easyui-combobox" id="com_PayNo" name="com_PayNo" style="width: 100%;" data-options="required:true">
                                    <option value="1">1st</option>
                                    <option value="2">2nd</option>
                                    <option value="3">3rd</option>
                                    <option value="4">4th</option>
                                    <option value="5">5th</option>
                                    <option value="6">Final</option>
                                </select>
                            </td>
                        </tr>
                         
                        <tr>
                            <td class="firstTd"><label for="txt_Remarks">{{Remark}}：</label></td>
                            <td class="nthTd" colspan="3"><input class="easyui-textbox" id="txt_Remarks" name="txt_Remarks" data-options="validType:'length[0,500]' " style="width:100%;" /></td>
                        </tr>
                        <tr> 
                            <td class="firstTd" style="width:130px"><label for="date_PlanPayDate">{{PlanPayDate}}：</label></td>
                            <td class="nthTd" style="width:360px"><input class="easyui-datebox" id="date_PlanPayDate" name="date_PlanPayDate" data-options="validType:'length[0,25]' " style="width:100%;" /></td>
                        </tr>
                        
                        <tr>
                            <td class="firstTd"><label for="txt_PlayFee">{{PlayFee}}：</label></td>
                            <td class="nthTd"><input class="easyui-numberbox" id="txt_PlayFee" name="txt_PlayFee" precision="2" data-options="required:true,validType:'length[1,9]',max:100 " style="width:100%;" /></td>
                        </tr>

                        <tr>
                            <td class="firstTd"><label for="date_PayDate">{{PayDate}}：</label></td>
                            <td class="nthTd"><input class="easyui-datebox" id="date_PayDate" name="date_PayDate" data-options="validType:'length[0,25]' " style="width:100%;" /></td>
                        </tr> 
                        
                        <tr>
                            <td class="firstTd" style="width:130px"><label for="chk_Status">{{Status}}：</label></td>
                            <td class="nthTd"><input type="checkbox" id="chk_Status" name="chk_Status" /></td>
                        </tr>


                    </table>
                </div>
            </div>
        </form>
    </div>

    <script>
         var projectId=@ViewBag.projectId;
        var vm_Feegridhead = new Vue({
            el: '#Fee_dgrid',
             data: {
                 PayNo: $setLang("Payment", "付款"),
                 Remark: $setLang("Remark", "说明"),
                 PlanPayDate: $setLang("Plan Pay Date", "计划付款时间"),
                 PlayFee: $setLang("Percentage", "百分比"),
                 PayDate: $setLang("Pay Date", "付款日期"),
                 Status: $setLang("Status", "状态"),
             }
         })
         //toolbar按钮
        var vm_Feetoolbar = new Vue({
            el: '#Fee_toolbar',
             data: {
                 Add: $lang("Add"),
                 Edit: $lang("Edit"),
                 Delete: $lang("Delete"),
             }
         }) 
        //增加修改模态框 PayNo Remark PlanPayDate PlayFee PayDate Status
        var vm_Feedialog = new Vue({
             el: '#dlg_addFeeDialog',
             data: {
                 title: $lang("Basic Information"),
                 PayNo: $setLang("Payment", "付款"),
                 Remark: $setLang("Remark", "说明"),
                 PlanPayDate: $setLang("Plan Pay Date", "计划付款时间"),
                 PlayFee: $setLang("Percentage", "百分比"),
                 PayDate: $setLang("Pay Date", "付款日期"),
                 Status: $setLang("Status", "状态"),


             }
         })

        $("#Fee_dgrid").datagrid({
            url: '/Project/PayScheduleSearch',
                 queryParams: {
                     'projectId': projectId,
                 },
         });
         //-------------------------------------------------------------------------

        var type_Fee = "Add"; //区分修改还是新增，修改：Edit
        var url_Fee = "/Project/PayScheduleAction";
         //新增相关****************************
        function AddFeeData() {
            $('#dlg_addFeeDialog').dialog({
                 title: $lang('Add'),
                 width: 520,
                 height: 350,
                 closed: false,
                 draggable: true,
                 resizable: true,
                 maximizable: true,
                 collapsible: true,
                 cache: false,
                 modal: true

             });
            type_Fee = "Add";
            $('#fmAdd_Fee').form('clear'); //清除表单,所有的
             //$('#fmAdd').form('reset'); //清除表单
             //$("#com_Sex").textbox('setValue', 'M');
             //$("#com_Active").textbox('setValue', 'In Office');
             //$("#com_Marital").textbox('setValue', 'Single');
             //$("#txt_LoginId").textbox({ 'disabled': false });
         }

         //更新数据按钮
        function Dialog_SaveFee() {
             $('#fmAdd_Fee').form('submit',
                 {
                     onSubmit: function () {
                         var b = $(this).form('enableValidation').form('validate');
                         if (b) {
                             var Id = 0;
                             if (type_Fee == "Edit") {
                                 Id = $("#Fee_dgrid").datagrid("getSelections")[0].Id;
                             }

                             var active = 0;
                             var chkvalue = $('#chk_Status').is(':checked');
                             if (chkvalue == true) {
                                 active = 1;
                             }

                             //创建传递的参数
                             var postdata = {
                                 Action: type_Fee,
                                 Id: Id,
                                 ProjectId:projectId, 
                                 PayNo: $("#com_PayNo").combobox('getValue'),
                                 Remark:$("#txt_Remarks").val(),
                                 PlanPayDate: $("#date_PlanPayDate").val(),
                                 PlayFee: $("#txt_PlayFee").val(),
                                 PayDate: $("#date_PayDate").val(),
                                 Status: active,
                             };
                            console.log(postdata);
                             //发送异步请求到后台保存用户数据
                             $.post(url_Fee,
                                 postdata,
                                 function (data, status) {
                                     if (status == "success" && data === "OK") {
                                         msgShow($lang('The System Prompt'), $lang('The Operation Successful'), 'info');
                                         $('#dlg_addFeeDialog').dialog('close');
                                         $("#Fee_dgrid").datagrid("reload");
                                     } else {
                                         msgShow($lang('The System Prompt'), $lang('The Operation Failure'), 'error');
                                     }
                                 });


                         } else {
                             msgShow($lang('The System Prompt'), $lang('Validation Failure'), 'warning');
                         }
                     }
                 });
         }

         //修改相关****************************
        function EditFeeData() {
            var CheckID = $("#Fee_dgrid").datagrid("getSelections");
             if (CheckID.length == 1) {
                   consolelog(CheckID);
                 // $("#txt_LoginId").textbox({ 'disabled': true });
                 $('#fmAdd_Fee').form('load', {
                     //com_UserName: CheckID[0].UserId,
                     com_PayNo: CheckID[0].PayNo,
                     txt_Remarks: CheckID[0].Remark,
                     date_PlanPayDate: CheckID[0].PlanPayDate,
                     txt_PlayFee: CheckID[0].PlayFee,
                     date_PayDate: CheckID[0].PayDate, 

                 });
                 var active = CheckID[0].Status;
                 if (active == 1) {
                     $("input[name='chk_Status']").prop("checked", true);
                 }
                 else {
                     $("input[name='chk_Status']").prop("checked", false);
                 }

                 type_Fee = "Edit";

                 $('#dlg_addFeeDialog').dialog({
                     title: $lang('Edit'),
                     width: 520,
                     height: 350,
                     closed: false,
                     draggable: true,
                     resizable: true,
                     maximizable: true,
                     collapsible: true,
                     cache: false,
                     modal: true
                 });
             }
             else {
                 if (CheckID.length == 0) {
                     msgShow($lang('The System Prompt'), $lang('Please Selected Data'), 'warning');
                 }
                 else {
                     msgShow($lang('The System Prompt'), $lang('You Can Only Selected One Data'), 'warning');
                 }
             }
         }
         //************************************
         //删除相关****************************
        function DeleteFeeData() {
            type_Fee = "Delete";
             //获取到用户选定ID
             var deleteID = $("#Fee_dgrid").datagrid("getSelections");

             if (deleteID.length >= 1) {
                 var id = deleteID[0].Id;
                 //发送异步请求删除数据
                 $.messager.confirm($lang('The System Prompt'), $lang('Are You Sure Delete Selected Data ?'),
                     function (DeleteSelect) {
                         if (DeleteSelect) {
                             $.post(url_Fee,
                                 { Action: type_Fee, Id: id },
                                 function (data, status) {
                                     consolelog(status);
                                     if (status == "success" && data == "OK") {
                                         msgShow($lang('The System Prompt'), $lang('The Operation Successful'), 'info');
                                         $("#Fee_dgrid").datagrid("reload");
                                         $("#Fee_dgrid").datagrid("clearSelections");
                                     } else {
                                         msgShow($lang('The System Prompt'), $lang('The Operation Failure'), 'error');
                                     }
                                 });
                         }
                     });
             } else {
                 msgShow($lang('The System Prompt'), $lang('Please Selected Data'), 'warning');
             }

         }
         //************************************
        function Statusformater(value, row, index) {
            var html = "<img src='../images/cross.png' />";
            if (value == 1)
                html = "<img src='../images/ok.png' />";

            return html;
        }
        function PayNoformater(value, row, index) {
            var html = "";
            if (value == 1)
            {
                html = "1th";
            }
            else if(value == 2)
            {
                html = "2nd";
            }
            else if(value == 3)
            {
                html = "3rd";
            }
            else if(value == 4)
            {
                html = "4th";
            }
            else if(value == 5)
            {
                html = "5th";
            } else if(value == 6)
            {
                html = "Final";
            }
            return html;
        } 
        function CreateDateFormat(value, row, index) {
            var str = "";
            if (value != null)
                str = jsonDateFormat(value);
            return str;
        }
    </script>



</body>






